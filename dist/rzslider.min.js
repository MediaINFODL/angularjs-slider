angular.module("rzModule",[]).value("throttle",function throttle(b,e,i){var c=(Date.now||function(){return new Date().getTime()});var a,g,j;var h=null;var f=0;i||(i={});var d=function(){f=i.leading===false?0:c();h=null;j=b.apply(a,g);a=g=null};return function(){var k=c();if(!f&&i.leading===false){f=k}var l=e-(k-f);a=this;g=arguments;if(l<=0){clearTimeout(h);h=null;f=k;j=b.apply(a,g);a=g=null}else{if(!h&&i.trailing!==false){h=setTimeout(d,l)}}return j}}).factory("Slider",["$timeout","$document","throttle",function(a,d,c){var b=function(g,f,e){this.scope=g;this.attributes=e;this.sliderElem=f;this.range=e.rzSliderHigh!==undefined&&e.rzSliderModel!==undefined;this.handleHalfWidth=0;this.maxLeft=0;this.precision=0;this.step=0;this.tracking="";this.minValue=0;this.maxValue=0;this.valueRange=0;this.initRun=false;this.customTrFn=null;this.fullBar=null;this.selBar=null;this.minH=null;this.maxH=null;this.flrLab=null;this.ceilLab=null;this.minLab=null;this.maxLab=null;this.cmbLab=null;this.container=null;this.init()};b.prototype={init:function(){var f=this;if(this.scope.rzSliderContainer){this.container=this.scope.rzSliderContainer}else{this.container=d}if(this.scope.rzSliderTranslate){this.customTrFn=this.scope.rzSliderTranslate()}this.initElemHandles();this.calcViewDimensions();this.setMinAndMax();this.precision=this.scope.rzSliderPrecision===undefined?0:+this.scope.rzSliderPrecision;this.step=this.scope.rzSliderStep===undefined?1:+this.scope.rzSliderStep;a(function(){f.updateCeilLab();f.updateFloorLab();f.initHandles();f.bindEvents()});this.scope.$on("reCalcViewDimensions",angular.bind(this,this.calcViewDimensions));angular.element(window).on("resize",angular.bind(this,this.calcViewDimensions));this.initRun=true;var g=c(function(){f.setMinAndMax();f.updateLowHandle(f.valueToOffset(f.scope.rzSliderModel));if(f.range){f.updateSelectionBar();f.updateCmbLabel()}},350,{leading:false});var e=c(function(){f.setMinAndMax();f.updateHighHandle(f.valueToOffset(f.scope.rzSliderHigh));f.updateSelectionBar();f.updateCmbLabel()},350,{leading:false});this.scope.$on("rzSliderForceRender",function(){f.resetLabelsValue();g();e();f.resetSlider()});this.scope.$watch("rzSliderModel",function(i,h){if(i===h){return}g()});this.scope.$watch("rzSliderHigh",function(i,h){if(i===h){return}e()});this.scope.$watch("rzSliderFloor",function(i,h){if(i===h){return}f.resetSlider()});this.scope.$watch("rzSliderCeil",function(i,h){if(i===h){return}f.resetSlider()})},resetSlider:function(){this.setMinAndMax();this.calcViewDimensions();this.updateCeilLab();this.updateFloorLab()},resetLabelsValue:function(){this.minLab.rzsv=undefined;this.maxLab.rzsv=undefined},initHandles:function(){this.updateLowHandle(this.valueToOffset(this.scope.rzSliderModel));if(this.range){this.updateHighHandle(this.valueToOffset(this.scope.rzSliderHigh));this.updateSelectionBar();this.updateCmbLabel()}},translateFn:function(i,g,f){f=f===undefined?true:f;var h=this.customTrFn&&f?""+this.customTrFn(i):""+i,e=false;if(g.rzsv===undefined||g.rzsv.length!=h.length||(g.rzsv.length>0&&g.rzsw==0)){e=true;g.rzsv=h}g.text(h);if(e){this.getWidth(g)}},setMinAndMax:function(){if(this.scope.rzSliderFloor){this.minValue=+this.scope.rzSliderFloor}else{this.minValue=this.scope.rzSliderFloor=0}if(this.scope.rzSliderCeil){this.maxValue=+this.scope.rzSliderCeil}else{this.scope.rzSliderCeil=this.maxValue=this.range?this.scope.rzSliderHigh:this.scope.rzSliderModel}this.valueRange=this.maxValue-this.minValue},initElemHandles:function(){angular.forEach(this.sliderElem.children(),function(g,e){var f=angular.element(g);switch(e){case 0:this.fullBar=f;break;case 1:this.selBar=f;break;case 2:this.minH=f;break;case 3:this.maxH=f;break;case 4:this.flrLab=f;break;case 5:this.ceilLab=f;break;case 6:this.minLab=f;break;case 7:this.maxLab=f;break;case 8:this.cmbLab=f;break}},this);this.fullBar.rzsl=0;this.selBar.rzsl=0;this.minH.rzsl=0;this.maxH.rzsl=0;this.flrLab.rzsl=0;this.ceilLab.rzsl=0;this.minLab.rzsl=0;this.maxLab.rzsl=0;this.cmbLab.rzsl=0;if(!this.range){this.cmbLab.remove();this.maxLab.remove();this.maxH.remove();this.selBar.remove()}},calcViewDimensions:function(){var e=this.getWidth(this.minH);this.handleHalfWidth=e/2;this.barWidth=this.getWidth(this.fullBar);this.maxLeft=this.barWidth-e;this.getWidth(this.sliderElem);this.sliderElem.rzsl=this.sliderElem[0].getBoundingClientRect().left;if(this.initRun){this.updateCeilLab();this.initHandles()}},updateCeilLab:function(){this.translateFn(this.scope.rzSliderCeil,this.ceilLab);this.setLeft(this.ceilLab,this.barWidth-this.ceilLab.rzsw);this.getWidth(this.ceilLab)},updateFloorLab:function(){this.translateFn(this.scope.rzSliderFloor,this.flrLab);this.getWidth(this.flrLab)},updateHandles:function(e,f){if(e==="rzSliderModel"){this.updateLowHandle(f);if(this.range){this.updateSelectionBar();this.updateCmbLabel()}return}if(e==="rzSliderHigh"){this.updateHighHandle(f);if(this.range){this.updateSelectionBar();this.updateCmbLabel()}return}this.updateLowHandle(f);this.updateHighHandle(f);this.updateSelectionBar();this.updateCmbLabel()},updateLowHandle:function(e){this.setLeft(this.minH,e);this.translateFn(this.scope.rzSliderModel,this.minLab);this.setLeft(this.minLab,e-this.minLab.rzsw/2+this.handleHalfWidth);this.shFloorCeil()},updateHighHandle:function(e){this.setLeft(this.maxH,e);this.translateFn(this.scope.rzSliderHigh,this.maxLab);this.setLeft(this.maxLab,e-this.maxLab.rzsw/2+this.handleHalfWidth);this.shFloorCeil()},shFloorCeil:function(){var f=false,e=false;if(this.minLab.rzsl<=this.flrLab.rzsl+this.flrLab.rzsw+5){f=true;this.hideEl(this.flrLab)}else{f=false;this.showEl(this.flrLab)}if(this.minLab.rzsl+this.minLab.rzsw>=this.ceilLab.rzsl-this.handleHalfWidth-10){e=true;this.hideEl(this.ceilLab)}else{e=false;this.showEl(this.ceilLab)}if(this.range){if(this.maxLab.rzsl+this.maxLab.rzsw>=this.ceilLab.rzsl-10){this.hideEl(this.ceilLab)}else{if(!e){this.showEl(this.ceilLab)}}if(this.maxLab.rzsl<=this.flrLab.rzsl+this.flrLab.rzsw+this.handleHalfWidth){this.hideEl(this.flrLab)}else{if(!f){this.showEl(this.flrLab)}}}},updateSelectionBar:function(){this.setWidth(this.selBar,this.maxH.rzsl-this.minH.rzsl);this.setLeft(this.selBar,this.minH.rzsl+this.handleHalfWidth)},updateCmbLabel:function(){var e,f;if(this.minLab.rzsl+this.minLab.rzsw+10>=this.maxLab.rzsl){if(this.customTrFn){e=this.customTrFn(this.scope.rzSliderModel);f=this.customTrFn(this.scope.rzSliderHigh)}else{e=this.scope.rzSliderModel;f=this.scope.rzSliderHigh}this.translateFn(e+" - "+f,this.cmbLab,false);this.setLeft(this.cmbLab,this.selBar.rzsl+this.selBar.rzsw/2-this.cmbLab.rzsw/2);this.hideEl(this.minLab);this.hideEl(this.maxLab);this.showEl(this.cmbLab)}else{this.showEl(this.maxLab);this.showEl(this.minLab);this.hideEl(this.cmbLab)}},roundStep:function(h){var f=this.step,g=(h-this.minValue)%f,e=g>(f/2)?h+f-g:h-g;return +(e).toFixed(this.precision)},hideEl:function(e){return e.css({opacity:0})},showEl:function(e){return e.css({opacity:1})},setLeft:function(e,f){e.rzsl=f;e.css({left:f+"px"});return f},getWidth:function(e){var f=e[0].getBoundingClientRect();e.rzsw=f.right-f.left;return e.rzsw},setWidth:function(f,e){f.rzsw=e;f.css({width:e+"px"});return e},valueToOffset:function(e){return(e-this.minValue)*this.maxLeft/this.valueRange},offsetToValue:function(e){return(e/this.maxLeft)*this.valueRange+this.minValue},bindEvents:function(){console.log(this.container);this.minH.on("mousedown",angular.bind(this,this.onStart,this.minH,"rzSliderModel"));if(this.range){this.maxH.on("mousedown",angular.bind(this,this.onStart,this.maxH,"rzSliderHigh"))}this.minH.on("touchstart",angular.bind(this,this.onStart,this.minH,"rzSliderModel"));if(this.range){this.maxH.on("touchstart",angular.bind(this,this.onStart,this.maxH,"rzSliderHigh"))}},onStart:function(g,f,e){e.stopPropagation();e.preventDefault();if(this.tracking!==""){return}this.calcViewDimensions();this.tracking=f;g.addClass("active");if(e.touches||(typeof(e.originalEvent)!="undefined"&&e.originalEvent.touches)){this.container.on("touchmove.rzslider",angular.bind(this,this.onMove,g));this.container.on("touchend.rzslider",angular.bind(this,this.onEnd))}else{this.container.on("mousemove.rzslider",angular.bind(this,this.onMove,g));this.container.on("mouseup.rzslider",angular.bind(this,this.onEnd))}},onMove:function(i,f){f.stopPropagation();f.preventDefault();var h=f.clientX||(typeof(f.originalEvent)!="undefined"?f.originalEvent.touches[0].clientX:f.touches[0].clientX),e=this.sliderElem.rzsl,j=h-e-this.handleHalfWidth,g;if(j<=0){if(i.rzsl!==0){this.scope[this.tracking]=this.minValue;this.updateHandles(this.tracking,0);this.scope.$apply()}return}if(j>=this.maxLeft){if(i.rzsl!==this.maxLeft){this.scope[this.tracking]=this.maxValue;this.updateHandles(this.tracking,this.maxLeft);this.scope.$apply()}return}g=this.offsetToValue(j);g=this.roundStep(g);if(this.range){if(this.tracking==="rzSliderModel"&&g>=this.scope.rzSliderHigh){this.scope[this.tracking]=this.scope.rzSliderHigh;this.updateHandles(this.tracking,this.maxH.rzsl);this.tracking="rzSliderHigh";this.minH.removeClass("active");this.maxH.addClass("active")}else{if(this.tracking==="rzSliderHigh"&&g<=this.scope.rzSliderModel){this.scope[this.tracking]=this.scope.rzSliderModel;this.updateHandles(this.tracking,this.minH.rzsl);this.tracking="rzSliderModel";this.maxH.removeClass("active");this.minH.addClass("active")}}}if(this.scope[this.tracking]!==g){this.scope[this.tracking]=g;this.updateHandles(this.tracking,j);this.scope.$apply()}},onEnd:function(e){e.stopPropagation();e.preventDefault();this.minH.removeClass("active");this.maxH.removeClass("active");if(e.touches||(typeof(e.originalEvent)!="undefined"&&e.originalEvent.touches)){this.container.unbind("touchmove.rzslider");this.container.unbind("touchend.rzslider")}else{this.container.unbind("mousemove.rzslider");this.container.unbind("mouseup.rzslider")}this.scope.$emit("slideEnded");this.tracking=""}};return b}]).directive("rzslider",["Slider",function(a){return{restrict:"EA",scope:{rzSliderFloor:"=?",rzSliderCeil:"=?",rzSliderStep:"@",rzSliderPrecision:"@",rzSliderModel:"=?",rzSliderHigh:"=?",rzSliderTranslate:"&",rzSliderContainer:"=?"},template:'<span class="bar"></span><span class="bar selection"></span><span class="pointer"></span><span class="pointer"></span><span class="bubble limit"></span><span class="bubble limit"></span><span class="bubble"></span><span class="bubble"></span><span class="bubble"></span>',link:function(c,d,b){return new a(c,d,b)}}}]);